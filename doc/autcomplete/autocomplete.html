<body>
  <input type="text" name="search" id="search" change::debounce:getValue:search:parse:display />
  <input type="text" name="search" id="search" change::debounce_500:getValue:search:parse:display />
  <div class="suggestions"></div>

  <script>
    // custom reaction implementation of debounce, time = 1000ms
    const sleepers = new WeakMap();
    const last = new WeakMap();
    customReactions.define("debounce", async function (e, oi) {
      const key = e.currentAttribute;
      let sleeper = sleepers.get(key);
      if (!sleeper) sleepers.put(key, (sleeper = new Promise((r) => setTimeout(r, 1000))));
      const kk = new Object();
      last.put(key, kk);
      await sleeper;
      sleepers.delete(key);
      const check = kk === last.get(key);
      last.delete(key);
      return check ? oi : customReactions.break;
    });

    // custom reaction rule implementation of debounce, time = 1000ms
    customReactions.defineRule("debounce_", function (name) {
      const active = new WeakSet();
      const delay = name.split("_")[1];
      return function (e, oi) {
        const key = e.currentAttribute;
        if (active.has(key)) return customReactions.break;
        active.add(key);
        return new Promise((r) => setTimeout(r, delay)).then(() => {
          active.delete(key);
          return oi;
        });
      };
    });

    customReactions.define("getValue", function (e, i) {
      let searchText = this.value;
      // if delete all text, clear the congetValue:tainer
      if (searchText === "" || searchText === " ") {
        let container = this.parentElement.lastChild;
        container.innerHTML = "";
      }
      let searchQuery = searchText.split(" ").join("+");
      return searchQuery;
    });

    customReactions.define("search", async function (e, i) {
      // call api to get data
      let response = await fetch("https://api.datamuse.com/sug?s=" + i);
      let responseData = await response.json();
      return data;
    });

    customReaction.define("parse", function (e, i) {
      let elements = ``;
      for (element of i) {
        elements += `<div><p>${element.word}</p></div>`;
      }
      return elements;
    });

    customReactions.defineRule("display", function (e, i) {
      // is this the correct this implementation?
      let container = this.parentElement.lastChild;
      container.innerHTML = i
    });

    // make pure funtion to parse response to html to inject in container
  </script>
</body>
